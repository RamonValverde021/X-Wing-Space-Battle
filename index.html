<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta name="author" content="Ramon Valverde">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Jogo estilo retrô de combate espacial inspirado em StarWars">
    <title>StarWars - X-Wing Space Battle</title>
    <link rel="icon" href="./images/icon.png">
    <link rel="stylesheet" type="text/css" href="./css/styles.css">
</head>

<body id="index">
    <button id="playIntro" class="botaoIndex">Iniciar Game</button>
    <video id="introVideo" src="./images/Intro_X-Wing_Space_Battle-2.mp4"></video>
    <script>
        const btn = document.getElementById("playIntro");
        const video = document.getElementById("introVideo");
        btn.addEventListener("click", () => {
            btn.style.display = "none";      // esconde botão
            video.style.display = "block";   // mostra vídeo
            video.play();                    // começa vídeo
        });
        // quando o vídeo terminar → redireciona para o jogo
        video.addEventListener("ended", () => {
            window.location.href = "./html/game.html"; // troca para a página do game
        });

        // Script para ler entradas do controle de X-Box
        window.addEventListener("gamepadconnected", (e) => {
            // Guarda o estado dos botões do frame anterior para detectar cliques (ações de um toque)
            let prevButtons = [];
            // loop para ler as entradas do controle a cada frame
            function update() {                                               // Inicia o loop de atualização que lê as entradas do controle a cada quadro.
                const gp = navigator.getGamepads()[e.gamepad.index];          // Pega o estado atual do gamepad conectado.
                if (!gp) {                                                    // Verifica se o gamepad foi desconectado.
                    // Se o controle for desconectado, para a nave
                    requestAnimationFrame(update);                            // Continua o loop de atualização no próximo quadro.
                    return;                                                   // Sai da função neste quadro, pois não há controle para ler.
                }
                gp.buttons.forEach((button, index) => {                                                            // Itera sobre todos os botões para verificar cliques únicos.
                    const foiClicado = button.pressed && (!prevButtons[index] || !prevButtons[index].pressed);     // Verifica se o botão foi pressionado neste quadro, mas não no anterior.
                    if (foiClicado) {
                        if (index === 9) {
                            btn.style.display = "none";      // esconde botão
                            video.style.display = "block";   // mostra vídeo
                            video.play();                    // começa vídeo                                                                       // Se o botão View/Select (índice 8) foi clicado.
                        }
                    }
                });
                // Salva o estado atual dos botões para comparar no próximo frame
                prevButtons = gp.buttons.map(b => ({ pressed: b.pressed, value: b.value }));                       // Salva o estado atual de todos os botões para a próxima verificação.
                requestAnimationFrame(update);                                                                     // Agenda a próxima execução da função 'update' para o próximo quadro de animação.
            }
            update();
        });

        window.addEventListener("gamepaddisconnected", (e) => {                                                    // Adiciona um ouvinte de evento para quando um controle é desconectado.
            console.log("Controle desconectado:", e.gamepad);                                                      // Exibe no console que o controle foi desconectado.
        });
    </script>
</body>

</html>