<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta name="author" content="Ramon Valverde">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="description" content="Jogo estilo retrÃ´ de combate espacial inspirado em StarWars">
    <title>StarWars - X-Wing Space Battle</title>
    <link rel="icon" href="./images/icon-192.png">
    <link rel="manifest" href="./manifest.json">
    <!-- <script language="JavaScript" src="./javascript/script.js" defer></script> -->
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        #tela_jogo {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            border: none;
        }
    </style>
</head>

<!--
    *Usar uma Ãºnica pÃ¡gina e trocar o conteÃºdo com JavaScript*

    Essa Ã© a forma profissional (e usada por praticamente todos os jogos web e PWAs).
    Em vez de abrir novos arquivos .html, vocÃª mantÃ©m um Ãºnico index.html e carrega o conteÃºdo dinamicamente via JavaScript.

    Assim o fullscreen continua ativo, porque vocÃª nunca sai do index.html.
    Essa tÃ©cnica Ã© o SPA (Single Page Application) â€” usada em frameworks como React, Vue e Angular, mas vocÃª pode fazer na mÃ£o tambÃ©m.

    *Usar um <iframe>

    Se quiser continuar com pÃ¡ginas separadas, dÃ¡ pra carregar as outras dentro de um iframe que permanece em fullscreen:
    AÃ­ vocÃª sÃ³ troca o src do iframe quando quiser mudar de â€œpÃ¡ginaâ€:

    window.parent.document.getElementById("tela_jogo").src = "./html/intro.html";
-->

<body id="index">

    <iframe id="tela_jogo" src="./html/intro.html"></iframe>

    <script>
        // Registra o Service Worker para funcionalidade PWA e cache offline.
        if ('serviceWorker' in navigator) {                                               // Verifica se o navegador do usuÃ¡rio suporta a tecnologia Service Worker.
            window.addEventListener('load', () => {                                       // Aguarda o evento 'load' da pÃ¡gina, garantindo que o registro nÃ£o atrase o carregamento inicial.
                navigator.serviceWorker.register('/service-worker.js')                    // Tenta registrar o arquivo do Service Worker, localizado na raiz do projeto.
                    .then(() => console.log("Service Worker registrado com sucesso âœ…")) // Se o registro for bem-sucedido, exibe uma mensagem de sucesso no console.
                    .catch(err => console.error("Erro ao registrar SW:", err, "ðŸš«"));    // Se ocorrer um erro durante o registro, exibe o erro no console.
            });
        }




        if (isMobile()) {
            console.log("Dispositivo mÃ³vel detectado ðŸ“±");
        } else {
            console.log("Desktop detectado ðŸ’»");
        }

        if (isMobile()) {
            if (isPWA()) {
                console.log("App PWA em execuÃ§Ã£o ðŸ“²");
                const dicaElement = document.getElementById("dica_modo");
                if (dicaElement) dicaElement.style.display = "none";
            } else {
                console.log("Navegador mÃ³vel detectado ðŸŒ");
                const dicaElement = document.getElementById("dica_modo");
                if (dicaElement) dicaElement.style.display = "block";
            }
            // Tanto no PWA quanto no navegador mÃ³vel, uma interaÃ§Ã£o do usuÃ¡rio Ã© necessÃ¡ria
            // para garantir o modo imersivo. O botÃ£o "Iniciar Jogo" jÃ¡ chama `ativarModoImersivo`.
            // Este listener adicional serve como um "backup" para qualquer toque na tela.
            window.addEventListener('click', ativarModoImersivo, { once: true });
            window.addEventListener('touchstart', ativarModoImersivo, { once: true });
        } else {
            console.log("Executando em desktop ðŸ’»");
        }

        console.log('Modo de exibiÃ§Ã£o atual:', window.matchMedia('(display-mode: standalone)').matches
            ? 'standalone'
            : 'browser');


        function isPWA() {
            return window.matchMedia('(display-mode: standalone)').matches
                || window.navigator.standalone;
        }

        function isMobile() {
            return /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
        }

        /**
         * Tenta colocar o jogo em tela cheia e travar a orientaÃ§Ã£o para paisagem.
         * Ideal para ser chamado por uma interaÃ§Ã£o do usuÃ¡rio em dispositivos mÃ³veis.
         */
        function ativarModoImersivo() {
            if (document.documentElement.requestFullscreen) {                                                                   // Verifica se o navegador suporta a API de tela cheia.
                document.documentElement.requestFullscreen().then(() => {                                                       // Solicita que o documento entre em modo de tela cheia.
                    // Assim que a tela cheia for ativada com sucesso, esconde a dica.
                    const dicaElement = document.getElementById("dica_modo");                                                   // ObtÃ©m o elemento da dica.
                    if (dicaElement) dicaElement.style.display = "none";                                                        // Esconde a dica.
                    if (screen.orientation && screen.orientation.lock) {                                                        // ApÃ³s entrar em tela cheia, verifica se a API de orientaÃ§Ã£o de tela e o mÃ©todo de trava sÃ£o suportados.
                        screen.orientation.lock('landscape').catch(err => console.error("Falha ao travar a orientaÃ§Ã£o:", err)); // Tenta travar a orientaÃ§Ã£o da tela para paisagem e captura qualquer erro.
                    }
                }).catch(err => console.error("Falha ao entrar em tela cheia:", err));                                          // Captura e exibe no console qualquer erro que ocorra ao tentar entrar em tela cheia.
            }
        }

    </script>

</body>

</html>