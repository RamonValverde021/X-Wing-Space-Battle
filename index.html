<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta name="author" content="Ramon Valverde">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="description" content="Jogo estilo retr√¥ de combate espacial inspirado em StarWars">
    <title>StarWars - X-Wing Space Battle</title>
    <link rel="icon" href="./images/icon-192.png">
    <link rel="manifest" href="./manifest.json">
    <!-- <script language="JavaScript" src="./javascript/script.js" defer></script> -->
    <style>
        @font-face {
            font-family: 'fontPixelArt';
            src: url("./font/ARCADECLASSIC.TTF");
        }

        * {
            /* Resetar modulos de espa√ßamentos*/
            margin: 0px;
            padding: 0px;
            font-family: fontPixelArt;
        }

        body,
        html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #000000;
        }

        #tela_jogo {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            border: none;
        }
    </style>
</head>

<!--
    *Usar uma √∫nica p√°gina e trocar o conte√∫do com JavaScript*

    Essa √© a forma profissional (e usada por praticamente todos os jogos web e PWAs).
    Em vez de abrir novos arquivos .html, voc√™ mant√©m um √∫nico index.html e carrega o conte√∫do dinamicamente via JavaScript.

    Assim o fullscreen continua ativo, porque voc√™ nunca sai do index.html.
    Essa t√©cnica √© o SPA (Single Page Application) ‚Äî usada em frameworks como React, Vue e Angular, mas voc√™ pode fazer na m√£o tamb√©m.

    *Usar um <iframe>

    Se quiser continuar com p√°ginas separadas, d√° pra carregar as outras dentro de um iframe que permanece em fullscreen:
    A√≠ voc√™ s√≥ troca o src do iframe quando quiser mudar de ‚Äúp√°gina‚Äù:

    window.parent.document.getElementById("tela_jogo").src = "./html/intro.html";
-->

<body id="index">

    <iframe id="tela_jogo" src="./html/intro.html"></iframe>

    <script>
        // Registra o Service Worker para funcionalidade PWA e cache offline.
        if ('serviceWorker' in navigator) {                                               // Verifica se o navegador do usu√°rio suporta a tecnologia Service Worker.
            window.addEventListener('load', () => {                                       // Aguarda o evento 'load' da p√°gina, garantindo que o registro n√£o atrase o carregamento inicial.
                navigator.serviceWorker.register('/service-worker.js')                    // Tenta registrar o arquivo do Service Worker, localizado na raiz do projeto.
                    .then(() => console.log("Service Worker registrado com sucesso ‚úÖ")) // Se o registro for bem-sucedido, exibe uma mensagem de sucesso no console.
                    .catch(err => console.error("Erro ao registrar SW:", err, "üö´"));    // Se ocorrer um erro durante o registro, exibe o erro no console.
            });
        }




        if (isMobile()) {
            console.log("Dispositivo m√≥vel detectado üì±");
        } else {
            console.log("Desktop detectado üíª");
        }

        if (isMobile()) {
            if (isPWA()) {
                console.log("App PWA em execu√ß√£o üì≤");
                const dicaElement = document.getElementById("dica_modo");
                if (dicaElement) dicaElement.style.display = "none";
            } else {
                console.log("Navegador m√≥vel detectado üåê");
                const dicaElement = document.getElementById("dica_modo");
                if (dicaElement) dicaElement.style.display = "block";
            }
            // Tanto no PWA quanto no navegador m√≥vel, uma intera√ß√£o do usu√°rio √© necess√°ria
            // para garantir o modo imersivo. O bot√£o "Iniciar Jogo" j√° chama `ativarModoImersivo`.
            // Este listener adicional serve como um "backup" para qualquer toque na tela.
            window.addEventListener('click', ativarModoImersivo, { once: true });
            window.addEventListener('touchstart', ativarModoImersivo, { once: true });
        } else {
            console.log("Executando em desktop üíª");
        }

        console.log('Modo de exibi√ß√£o atual:', window.matchMedia('(display-mode: standalone)').matches
            ? 'standalone'
            : 'browser');


        function isPWA() {
            return window.matchMedia('(display-mode: standalone)').matches
                || window.navigator.standalone;
        }

        function isMobile() {
            return /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
        }

        /**
         * Tenta colocar o jogo em tela cheia e travar a orienta√ß√£o para paisagem.
         * Ideal para ser chamado por uma intera√ß√£o do usu√°rio em dispositivos m√≥veis.
         */
        function ativarModoImersivo() {
            if (document.documentElement.requestFullscreen) {                                                                   // Verifica se o navegador suporta a API de tela cheia.
                document.documentElement.requestFullscreen().then(() => {                                                       // Solicita que o documento entre em modo de tela cheia.
                    // Assim que a tela cheia for ativada com sucesso, esconde a dica.
                    const dicaElement = document.getElementById("dica_modo");                                                   // Obt√©m o elemento da dica.
                    if (dicaElement) dicaElement.style.display = "none";                                                        // Esconde a dica.
                    if (screen.orientation && screen.orientation.lock) {                                                        // Ap√≥s entrar em tela cheia, verifica se a API de orienta√ß√£o de tela e o m√©todo de trava s√£o suportados.
                        screen.orientation.lock('landscape').catch(err => console.error("Falha ao travar a orienta√ß√£o:", err)); // Tenta travar a orienta√ß√£o da tela para paisagem e captura qualquer erro.
                    }
                }).catch(err => console.error("Falha ao entrar em tela cheia:", err));                                          // Captura e exibe no console qualquer erro que ocorra ao tentar entrar em tela cheia.
            }
        }

    </script>

</body>

</html>